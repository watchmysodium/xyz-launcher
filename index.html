<!-- Replace your card creation logic with this snippet -->
<script>
/* Example: games is an array of objects that may include:
   { title, header_image, link, steam_appid }  -- adapt to your data shape.
   If you're fetching from Hydra sources, use their "link" field for Visit Source.
   If you fetched Steam appdetails earlier, use steam_appid to open the Steam store.
*/

function createGameCard(g) {
  const card = document.createElement('div');
  card.className = 'card';

  const title = (g.title || g.name || 'Untitled');
  const img = g.header_image || g.background_image || 'https://placehold.co/400x200/000/fff?text=No+Image';
  const sourceLink = g.link || g.url || ''; // repack / hydra link
  const steamAppId = g.steam_appid || g.appid || null; // optional Steam ID

  card.innerHTML = `
    <img class="thumb" src="${img}" alt="">
    <div class="name">${escapeHtml(title)}</div>
    <div class="desc">${escapeHtml(g.short_description || g.description || '')}</div>
    <div class="actions"></div>
  `;

  const actions = card.querySelector('.actions');

  // Visit Source (Hydra / repack link) - opens in new tab (user-initiated)
  if (sourceLink) {
    const visitBtn = document.createElement('button');
    visitBtn.className = 'btn';
    visitBtn.textContent = 'Visit Source';
    visitBtn.addEventListener('click', () => {
      // Open user-visited page (allowed)
      window.open(sourceLink, '_blank', 'noopener');
    });
    actions.appendChild(visitBtn);
  }

  // View on Steam if we have steamAppId
  if (steamAppId) {
    const steamBtn = document.createElement('button');
    steamBtn.className = 'btn';
    steamBtn.textContent = 'View on Steam';
    steamBtn.addEventListener('click', () => {
      window.open(`https://store.steampowered.com/app/${encodeURIComponent(steamAppId)}`, '_blank', 'noopener');
    });
    actions.appendChild(steamBtn);
  }

  // Download -> show polite modal encouraging legal purchase
  const downloadBtn = document.createElement('button');
  downloadBtn.className = 'btn primary';
  downloadBtn.textContent = 'Download';
  downloadBtn.addEventListener('click', () => {
    showLegalModal("Support the devs â€” piracy is a crime. Downloads are disabled in this launcher. Please purchase the game on the official store to support the developers.");
  });
  actions.appendChild(downloadBtn);

  return card;
}

/* Modal helper */
function showLegalModal(message){
  const existing = document.querySelector('.modal-backdrop');
  if (existing) existing.remove();

  const backdrop = document.createElement('div');
  backdrop.className = 'modal-backdrop';
  backdrop.innerHTML = `
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-header">
        <span class="material-icons">error_outline</span>
        <strong>Notice</strong>
      </div>
      <div class="modal-body">${message}</div>
      <div class="modal-footer">
        <button id="modalOk">OK</button>
      </div>
    </div>
  `;
  backdrop.querySelector('#modalOk').onclick = () => backdrop.remove();
  document.body.appendChild(backdrop);
}

/* small HTML-escape helper */
function escapeHtml(str){
  if (!str) return '';
  return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}

/* Example usage if you have an array `games` */
function renderGames(games){
  const container = document.getElementById('games');
  container.innerHTML = '';
  for (const g of games) {
    const card = createGameCard(g);
    container.appendChild(card);
  }
}
</script>
